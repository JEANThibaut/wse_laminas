<?php foreach ($this->flashMessenger()->getMessages() as $message): ?>
    <div class="alert alert-info"><?= $this->escapeHtml($message) ?></div>
<?php endforeach; ?>
<?php foreach ($this->flashMessenger()->getErrorMessages() as $message): ?>
    <div class="alert alert-danger"><?= $this->escapeHtml($message) ?></div>
<?php endforeach; ?>
<?php foreach ($this->flashMessenger()->getSuccessMessages() as $message): ?>
    <div class="alert alert-success"><?= $this->escapeHtml($message) ?></div>
<?php endforeach; ?>
<?php foreach ($this->flashMessenger()->getWarningMessages() as $message): ?>
    <div class="alert alert-warning"><?= $this->escapeHtml($message) ?></div>
<?php endforeach; ?>

<div class="mb-3">
    <a href="<?= $this->url('actus-create') ?>" class="btn btn-warning">
        Ajouter une actu
    </a>
</div>

<div class="card mt-3">
    <h4>Actus</h4>

    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>Titre</th>
                <th>Type</th>
                <th>Date</th>
                <th>Statut</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        <?php foreach ($actus as $actu): ?>
            <tr>
                <td><?= $this->escapeHtml($actu->getTitre()) ?></td>
                <td><?= $this->escapeHtml($actu->getType()) ?></td>
                <td><?= $actu->getDate() ? $this->escapeHtml($actu->getDate()->format('d/m/Y')) : '' ?></td>
                <td><?= $actu->getIsActive() ? 'Actif' : 'Inactif' ?></td>
                <td>
                    <div class="d-flex justify-content-between" style="gap: 0.5rem;">
                        <a href="<?= $this->url('actus-edit', ['id' => $actu->getIdactus()]) ?>" class="btn btn-sm btn-warning">
                            <i class="fa-solid fa-edit"></i>
                        </a>
                        <button type="button"
                                class="btn btn-sm btn-danger btn-delete-actus"
                                data-id="<?= $this->escapeHtmlAttr($actu->getIdactus()) ?>"
                                data-title="<?= $this->escapeHtmlAttr($actu->getTitre()) ?>">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
</div>

<div class="modal fade" id="confirmDeleteActusModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="<?= $this->url('actus-delete') ?>" id="confirmDeleteActusForm">
                <input type="hidden" name="id" id="confirmDeleteActusId">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body">
                    Êtes-vous sûr de vouloir supprimer cette actu
                    <span id="confirmDeleteActusTitle" class="fw-bold"></span> ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-danger">Confirmer</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const modalElement = document.getElementById('confirmDeleteActusModal');
        const modal = modalElement ? new bootstrap.Modal(modalElement) : null;
        const idInput = document.getElementById('confirmDeleteActusId');
        const titleSpan = document.getElementById('confirmDeleteActusTitle');

        document.querySelectorAll('.btn-delete-actus').forEach(button => {
            button.addEventListener('click', function () {
                if (!modal || !idInput || !titleSpan) {
                    return;
                }

                const id = this.getAttribute('data-id');
                const title = this.getAttribute('data-title') || '';
                idInput.value = id;
                titleSpan.textContent = title ? `"${title}"` : '';
                modal.show();
            });
        });
    });
</script>
